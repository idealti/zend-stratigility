<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="zend-stratigility">  
    <link rel="canonical" href="https://docs.zendframework.com/v3/middleware/">
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Middleware - zend-stratigility - Zend Framework Docs</title>

    <link rel="stylesheet" href="/css/styles.css">
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">zend-stratigility</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                
                    
                        
    <li class="subnavigation__list-item ">
        <a href="../intro/" class="subnavigation__link">Intro</a>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Reference</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../install/" class="subnavigation__link">Installation and Requirements</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../usage/" class="subnavigation__link">Usage</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../error-handlers/" class="subnavigation__link">Error Handlers</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../creating-middleware/" class="subnavigation__link">Creating Middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../executing-middleware/" class="subnavigation__link">Composing middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../api/" class="subnavigation__link">API Reference</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../migration/" class="subnavigation__link">Migration</a>
    </li>

            
        </ul>
    </li>

                    
                
            

                
                

                    
                    
                
            

                
                

                    
                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">zend-stratigility</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    
<div class="version-selector">
    <div class="btn-group">
        <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            
                v3
            
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            
                
                    <li class="dropdown-menu__item dropdown-menu__item--selected">
                        <a href="../intro/">
                            
                                v3 (latest)
                            
                        </a>
                    </li>
                
            
                
                    <li class="dropdown-menu__item">
                        <a href="../../v2/install/">
                            
                                v2
                            
                        </a>
                    </li>
                
            
                
                    <li class="dropdown-menu__item">
                        <a href="../../v1/install/">
                            
                                v1
                            
                        </a>
                    </li>
                
            
        </ul>
    </div>
</div>


                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/zend-stratigility/" class="header__link header__link--github" title="Go to repository of zend-stratigility">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="laminas-announcement">
    <div class="container">
        <div class="row">
            <div class="col-xs-12"><strong>
                This package has moved. Visit its replacement, <a href="https://docs.laminas.dev/laminas-stratigility/">laminas/laminas-stratigility.</a>
            </strong></div>
        </div>
    </div>
</div>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
            <!-- content:begin -->
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
    <li><a href="https://framework.zend.com/">Home</a></li>

    
        <li><a href="https://docs.zendframework.com/">Documentation</a></li>

        
            <li><a href="../..">zend-stratigility</a></li>

            
                
                    
                    
                
            
                
                    
                    
                        <li>Reference</li>
                    
                
            

            <li class="active">Middleware</li>
        
    
</ol>






    
    
        <h2 class="chapter__headline">Reference</h2>
    

    <div>
        
    

    
    

    </div>

    <h1 id="middleware">Middleware</h1>
<p>What is middleware?</p>
<p>Middleware is code that exists between the request and response, and which can
take the incoming request, perform actions based on it, and either complete the
response or pass delegation on to the next middleware in the queue.</p>
<pre><code class="language-php">// In public/index.php:
use Zend\Diactoros\Response;
use Zend\Diactoros\Server;
use Zend\Stratigility\Middleware\NotFoundHandler;
use Zend\Stratigility\MiddlewarePipe;

use function Zend\Stratigility\middleware;
use function Zend\Stratigility\path;

require __DIR__ . '/../vendor/autoload.php';

$app = new MiddlewarePipe();

$server = Server::createServer([$app, 'handle'], $_SERVER, $_GET, $_POST, $_COOKIE, $_FILES);

// Landing page
$app-&gt;pipe(middleware(function ($req, $handler) {
    if (! in_array($req-&gt;getUri()-&gt;getPath(), ['/', ''], true)) {
        return $handler-&gt;handle($req);
    }

    $response = new Response();
    $response-&gt;getBody()-&gt;write('Hello world!');

    return $response;
}));

// Another page
$app-&gt;pipe(path('/foo', middleware(function ($req, $handler) {
    $response = new Response();
    $response-&gt;getBody()-&gt;write('FOO!');

    return $response;
})));

// 404 handler
$app-&gt;pipe(new NotFoundHandler(function () {
    return new Response();
}));

$server-&gt;listen(function ($req, $res) {
    return $res;
});
</code></pre>

<p>In the above example, we have two examples of middleware. The first is a
landing page, and listens at the root path. If the request path is empty or
<code>/</code>, it completes the response. If it is not, it delegates to the next
middleware in the stack. The second middleware matches on the path <code>/foo</code>
&mdash; meaning it will match <code>/foo</code>, <code>/foo/</code>, and any path beneath. In that
case, it will complete the response with its own message. If no paths match at
this point, a "final handler" is composed by default to report 404 status.</p>
<p>So, concisely put, <em>middleware are PHP callables that accept a request object,
and do something with it, optionally delegating creation of a response to
another handler</em>.</p>
<blockquote>
<h3>PSR-15 middleware</h3>
<p>Stratigility supports only <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-15-request-handlers.md">PSR-15</a>
middleware.</p>
</blockquote>
<p>Middleware can decide more processing can be performed by calling the <code>$handler</code>
instance passed during invocation. With this paradigm, you can build a workflow
engine for handling requests &mdash; for instance, you could have middleware
perform the following:</p>
<ul>
<li>Handle authentication details</li>
<li>Perform content negotiation</li>
<li>Perform HTTP negotiation</li>
<li>Route the path to a more appropriate, specific handler</li>
</ul>
<p>Each middleware can itself be middleware.</p>
<p>Using the provided <code>PathMiddlewareDecorator</code> (created by the <code>path()</code> function
demonstrated in the initial example), you can also attach middleware to specific
paths, allowing you to mix and match applications under a common domain. As an
example, you could put API middleware next to middleware that serves its
documentation, next to middleware that serves files, and segregate each by URI:</p>
<pre><code class="language-php">$app-&gt;pipe(path('/api', $apiMiddleware));
$app-&gt;pipe(path('/docs', $apiDocMiddleware));
$app-&gt;pipe(path('/files', $filesMiddleware));
</code></pre>

<p>The handlers in each middleware attached this way will see a URI with that path
segment stripped, allowing them to be developed separately and re-used under
any path you wish.</p>
<p>Within Stratigility, middleware must be
<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-15-request-handlers.md">PSR-15</a> middleware.
<code>Zend\Stratigility\MiddlewarePipe</code> implements
<code>Psr\Http\Server\MiddlewareInterface</code>.</p>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../usage/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../error-handlers/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>




    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/zendframework/zend-stratigility/edit/master/docs/book/v3/middleware.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            <!-- content:end -->
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">zend-stratigility</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                
                    
                        
    <li class="subnavigation__list-item ">
        <a href="../intro/" class="subnavigation__link">Intro</a>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Reference</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../install/" class="subnavigation__link">Installation and Requirements</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../usage/" class="subnavigation__link">Usage</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../error-handlers/" class="subnavigation__link">Error Handlers</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../creating-middleware/" class="subnavigation__link">Creating Middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../executing-middleware/" class="subnavigation__link">Composing middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../api/" class="subnavigation__link">API Reference</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../migration/" class="subnavigation__link">Migration</a>
    </li>

            
        </ul>
    </li>

                    
                
            

                
                

                    
                    
                
            

                
                

                    
                    
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2020 by <a href="https://www.zend.com/">Zend</a> by <a href="https://www.perforce.com/">Perforce</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://laminas.dev/chat/" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

<nav class="cookie-bar navbar navbar-fixed-bottom navbar-default hidden">
    <div class="container">
        <p class="navbar-text">
            We use cookies to allow you to dismiss dialogs such as the Laminas
            Project notification.
        </p>
        <button type="button" class="cookie-button btn btn-default navbar-btn">Allow Cookies</button>
    </div>
</nav>

    <script>
        var base_url = '../..',
            siteName = 'zend-stratigility';
    </script>
    <script src="/js/scripts.js"></script>
    <script src="../../search/main.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>



</body>


</html>
